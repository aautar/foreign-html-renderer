var ForeignHtmlRenderer=function(a){'use strict';const b={};b.ContentType={APPLICATION_JSON:"application/json"},b.convertBlobToString=function(a,b){const c=new FileReader;c.readAsText(a),c.onloadend=function(){b(c.result)}},b.parseXHRResponseData=function(a,c){if(a.type===b.ContentType.APPLICATION_JSON){var d={};try{b.convertBlobToString(a,function(a){d=JSON.parse(a)})}catch(a){}c(d)}else"text"===a.type.split("/")[0]?b.convertBlobToString(a,function(a){c(a)}):c(a)},b.makeFormDataRequestData=function(a,b){return{body:a,headers:b||new Map}},b.makeJsonRequestData=function(a,c){return c=c||new Map,c.set("Content-Type",b.ContentType.APPLICATION_JSON),{body:JSON.stringify(a),headers:c}},b.makeBlobRequestData=function(a,b){return b=b||new Map,b.set("Content-Type",a.type),{body:a,headers:b}},b.xhr=function(a,c,d,e,f,g){const h=d.headers;e=e||(()=>{}),f=f||(()=>{}),g=g||(()=>{});const i=function(a,c){c?f(c,j):b.parseXHRResponseData(j.response,function(a){f(a,j)})},j=new XMLHttpRequest;j.open(a,c);for(let[b,i]of h)j.setRequestHeader(b,i);return j.responseType="blob",j.timeout=3e4,j.onload=function(){400<=j.status?i():b.parseXHRResponseData(j.response,function(a){e(a,j)})},j.ontimeout=function(){i(j,"client timeout")},j.onerror=function(){i()},j.onloadend=function(){b.parseXHRResponseData(j.response,function(a){g(a,j)})},j.send(d.body),j},b.post=function(a,c,d,e,f){return b.xhr("POST",a,c,d,e,f)},b.put=function(a,c,d,e,f){return b.xhr("PUT",a,c,d,e,f)},b.delete=function(a,c,d,e,f){return b.xhr("DELETE",a,c,d,e,f)},b.get=function(a,c,d,e,f){return b.xhr("GET",a,{body:null,headers:c},d,e,f)},b.head=function(a,c,d,e,f){return b.xhr("HEAD",a,{body:null,headers:c},d,e,f)},b.postBeacon=function(a,b){return navigator.sendBeacon(a,b.body)};return a.ImageRenderer=function(a){const c=this,d=function(a){return new Promise(function(b){const c=new FileReader;c.readAsDataURL(a),c.onloadend=function(){b(c.result)}})},e=function(a){return new Promise(function(c,e){b.get(a,new Map,async b=>{const e=await d(b);c({resourceUrl:a,resourceBase64:e})},()=>{e("xhr request failed")})})},f=function(a){const b=[];for(let c=0;c<a.length;c++)b.push(e(a[c]));return Promise.all(b)},g=function(a,b,c,d){const e=a.indexOf(c,b);if(-1===e)return null;let f="";for(let g=e+c.length;g<a.length&&-1===d.indexOf(a[g]);g++)f+=a[g];return{foundAtIndex:e,value:f}},h=function(a){const b=[];for(let c=0;;){const d=g(a,c,"url(",[")"]);if(null===d)break;c=d.foundAtIndex+d.value.length,b.push(j(d.value))}return b},i=function(a){const b=[];for(let c=0;;){const d=g(a,c,"src=",[" ",">","\t"]);if(null===d)break;c=d.foundAtIndex+d.value.length,b.push(j(d.value))}return b},j=function(a){return a.replace(/["']/g,"")},k=function(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},l=async function(b,c,d){return new Promise(async function(e){let g="",l=[];for(let b=0;b<a.length;b++)for(let c=0;c<a[b].cssRules.length;c++){const d=a[b].cssRules[c].cssText;l.push(...h(d)),g+=d}const m=await f(l);for(let a=0;a<m.length;a++){const b=m[a];g=g.replace(new RegExp(k(b.resourceUrl),"g"),b.resourceBase64)}let n=i(b);const o=await f(n);for(let a=0;a<o.length;a++){const c=o[a];b=b.replace(new RegExp(k(c.resourceUrl),"g"),c.resourceBase64)}const p=document.createElement("style");p.innerHTML=g;const q=new XMLSerializer().serializeToString(p),r=document.createElement("div");r.innerHTML=q+b,r.setAttribute("xmlns","http://www.w3.org/1999/xhtml");const s=new XMLSerializer().serializeToString(r),t=`data:image/svg+xml;base64,${window.btoa(`
                <svg xmlns='http://www.w3.org/2000/svg' width='${c}' height='${d}'>
                    <g transform='translate(0, 0) rotate(0)'>
                        <foreignObject x='0' y='0' width='${c}' height='${d}'>
                            ${s}
                        </foreignObject>
                    </g>
                </svg>`)}`;e(t)})};this.renderToImage=async function(a,b,c){return new Promise(async function(d){const e=new Image;e.src=await l(a,b,c),e.onload=function(){d(e)}})},this.renderToCanvas=async function(a,b,d){return new Promise(async function(e){const f=await c.renderToImage(a,b,d),g=document.createElement("canvas");g.width=f.width,g.height=f.height;const h=g.getContext("2d");h.drawImage(f,0,0,f.width,f.height),e(g)})},this.renderToBase64Png=async function(a,b,d){return new Promise(async function(e){const f=await c.renderToCanvas(a,b,d);e(f.toDataURL("image/png"))})}},a}({});
