var ForeignHtmlRenderer=function(a){"use strict";const b={};b.ContentType={APPLICATION_JSON:"application/json"},b.convertBlobToString=function(a,b){const c=new FileReader;c.readAsText(a),c.onloadend=function(){b(c.result)}},b.parseXHRResponseData=function(a,c){if("undefined"==typeof a||null===a||0===a.size)return void c(a);if(a.type===b.ContentType.APPLICATION_JSON){var d={};b.convertBlobToString(a,function(a){d=JSON.parse(a),c(d)})}else"text"===a.type.split("/")[0]?b.convertBlobToString(a,function(a){c(a)}):c(a)},b.makeFormDataRequestData=function(a,b){return{body:a,headers:b||new Map}},b.makeJsonRequestData=function(a,c){return c=c||new Map,c.set("Content-Type",b.ContentType.APPLICATION_JSON),{body:JSON.stringify(a),headers:c}},b.makeBlobRequestData=function(a,b){return b=b||new Map,b.set("Content-Type",a.type),{body:a,headers:b}},b.makeUrlQueryString=function(a){const b=[];for(let[c,d]of a)b.push(`${c}=${encodeURIComponent(d)}`);return"?"+b.join("&")},b.xhr=function(a,c,d,e,f,g,h){const i=d.headers;e=e||(()=>{}),f=f||(()=>{}),g=g||(()=>{});const j=function(a,c){c?f(c,k):b.parseXHRResponseData(k.response,function(a){f(a,k)})},k=new XMLHttpRequest;k.open(a,c);for(let[b,j]of i)k.setRequestHeader(b,j);return k.responseType="blob",k.timeout=h&&h.timeout?h.timeout:3e4,k.onload=function(){400<=k.status?j():b.parseXHRResponseData(k.response,function(a){e(a,k)})},k.ontimeout=function(){j(k,"client timeout")},k.onerror=function(){j()},k.onloadend=function(){b.parseXHRResponseData(k.response,function(a){g(a,k)})},k.send(d.body),k},b.post=function(a,c,d,e,f){return b.xhr("POST",a,c,d,e,f)},b.put=function(a,c,d,e,f){return b.xhr("PUT",a,c,d,e,f)},b.delete=function(a,c,d,e,f){return b.xhr("DELETE",a,c,d,e,f)},b.get=function(a,c,d,e,f){return b.xhr("GET",a,{body:null,headers:c},d,e,f)},b.head=function(a,c,d,e,f){return b.xhr("HEAD",a,{body:null,headers:c},d,e,f)},b.postBeacon=function(a,b){return navigator.sendBeacon(a,b.body)};return a.ImageRenderer=function(a){const c=this;let d="",e=null;const f=function(a){return new Promise(function(b){const c=new FileReader;c.readAsDataURL(a),c.onloadend=function(){b(c.result)}})},g=function(a){return new Promise(function(c,d){b.get(a,new Map,async(b,d)=>{if("Blob"!==d.response.constructor.name)c({resourceUrl:a,resourceBase64:null});else{const b=await f(d.response);c({resourceUrl:a,resourceBase64:b})}},()=>{d("xhr request failed")})})},h=function(a){const b=[];for(let c=0;c<a.length;c++)b.push(g(a[c]));return Promise.all(b)},i=function(a,b,c,d){const e=a.indexOf(c,b);if(-1===e)return null;let f="";for(let g=e+c.length;g<a.length&&-1===d.indexOf(a[g]);g++)f+=a[g];return{foundAtIndex:e,value:f}},k=function(a){const b=[];for(let c=0;;){const d=i(a,c,"url(",[")"]);if(null===d)break;c=d.foundAtIndex+d.value.length,b.push(m(d.value))}return b},l=function(a){const b=[];for(let c=0;;){const d=i(a,c,"src=",[" ",">","\t"]);if(null===d)break;c=d.foundAtIndex+d.value.length,b.push(m(d.value))}return b},m=function(a){return a.replace(/["']/g,"")},n=function(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},o=async function(a,b,c){return new Promise(async function(g){await e;let i=d,j=l(a);const k=await h(j);for(let b=0;b<k.length;b++){const c=k[b];a=a.replace(new RegExp(n(c.resourceUrl),"g"),c.resourceBase64)}const m=document.createElement("style");m.innerHTML=i;const o=new XMLSerializer().serializeToString(m),p=document.createElement("div");p.innerHTML=o+a,p.setAttribute("xmlns","http://www.w3.org/1999/xhtml");const q=new XMLSerializer().serializeToString(p),r=new Blob([new TextEncoder().encode(`
                <svg xmlns='http://www.w3.org/2000/svg' width='${b}' height='${c}'>
                    <g transform='translate(0, 0) rotate(0)'>
                        <foreignObject x='0' y='0' width='${b}' height='${c}'>
                            ${q}
                        </foreignObject>
                    </g>
                </svg>`)],{type:"image/svg+xml;base64"}),s=await f(r);g(s)})};this.renderToImage=async function(a,b,c){return new Promise(async function(d){const e=new Image;e.src=await o(a,b,c),e.onload=function(){d(e)}})},this.renderToCanvas=async function(a,b,d){return new Promise(async function(e){const f=await c.renderToImage(a,b,d),g=document.createElement("canvas");g.width=f.width,g.height=f.height;const h=g.getContext("2d");h.drawImage(f,0,0,f.width,f.height),e(g)})},this.renderToBase64Png=async function(a,b,d){return new Promise(async function(e){const f=await c.renderToCanvas(a,b,d);e(f.toDataURL("image/png"))})},e=async function(){let b="";const c=[];for(let d=0;d<a.length;d++){try{a[d].cssRules}catch(b){console.warn("Inaccessible stylesheet: "+a[d].href);continue}for(let e=0;e<a[d].cssRules.length;e++){const f=a[d].cssRules[e].cssText;c.push(...k(f)),b+=f}}const e=await h(c);for(let a=0;a<e.length;a++){const c=e[a];b=b.replace(new RegExp(n(c.resourceUrl),"g"),c.resourceBase64)}d=b}()},Object.defineProperty(a,"__esModule",{value:!0}),a}({});
